<!DOCTYPE html>
<html>
<head>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <script type="x-shader/x-vertex" id="vshader">
	attribute vec4 aPosition;
	attribute vec4 aNormal;

	uniform mat4 uModelMatrix;
	uniform mat4 uViewMatrix;
	uniform mat4 uProjectionMatrix;
	uniform mat4 uNormalMatrix;

	uniform vec4 uMaterialDiffuseColor;
	uniform vec4 uLightDiffuseColor;
	uniform vec4 uLightSpecularColor; // New uniform for specular color
	uniform float uShininess; // New uniform for shininess

	varying vec4 vPosition;
	varying vec4 vNormal;
	varying vec4 vEyeDirection; // New varying for eye direction

	void main() {
		gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix * aPosition;
		vPosition = uModelMatrix * aPosition;
		vNormal = uNormalMatrix * aNormal;

		// Calculate eye direction
		vEyeDirection = -vPosition;
	}
  </script>

  <script type="x-shader/x-fragment" id="fshader">
	precision mediump float;
  
	varying vec4 vPosition;
	varying vec4 vNormal;
	varying vec4 vEyeDirection;
	
	uniform vec4 uLightDirectionVector;
	uniform vec4 uEyePosition; // New uniform for eye position
	
	uniform vec4 uMaterialDiffuseColor;
	uniform vec4 uLightDiffuseColor;
	uniform vec4 uLightSpecularColor;
	uniform float uShininess;
	
	void main() {
		// Calculate normalized normal and light vector
		vec4 normalizedNormal = normalize(vNormal);
		vec4 normalizedLightDir = normalize(uLightDirectionVector);
		
		// Calculate view direction
		vec4 viewDirection = normalize(uEyePosition - vPosition);
		
		// Calculate specular reflection
		vec4 reflectionDirection = reflect(-normalizedLightDir, normalizedNormal);
		float specular = pow(max(dot(reflectionDirection, viewDirection), 0.0), uShininess);
		
		// Calculate final color using Phong lighting model
		vec4 ambientColor = uMaterialDiffuseColor * uLightDiffuseColor;
		vec4 diffuseColor = max(dot(normalizedLightDir, normalizedNormal), 0.0) * uMaterialDiffuseColor * uLightDiffuseColor;
		vec4 specularColor = specular * uLightSpecularColor;
		
		vec4 finalColor = ambientColor + diffuseColor + specularColor;
		
		gl_FragColor = finalColor;
	}
  </script>
  <script src="https://cdn.jsdelivr.net/npm/gl-matrix@2.4.0/dist/gl-matrix.js"></script>
  <script src="./lib/webgl-init.js"></script>
  <script src="./lib/webgl-utils.js"></script>
  <script src="./lib/webgl-debug.js"></script>
  <script src="./lib/gl-matrix-min.js"></script>

  <script src="main.js" type="module"></script>
</head>
<body>
	<div class="container">
		<div class="row">
		  <div class="col">
			<canvas id="main_canvas" width="800" height="800" style="border: 1px black solid; ">
			</canvas>
		  </div>
			<div class="col container-fluid shadow p-2">
			  <hr>
			  <b>Animation:</b> <button type="button" class="btn btn-primary btn-sm" id="animate">On</button>
			  <hr>
			  <div class="col">
				<b>Lighting Model: </b>
				<div id="activeModel" class="pt-3">Active Model: Lambert</div>
				<div class="pt-3">
				  <button type="button" class="btn btn-primary btn-sm" id="lambert">Lambert</button>
				</div>
				<div class="pt-3">
				  <button type="button" class="btn btn-primary btn-sm" id="phong">Phong</button>
				</div>
			  </div>
			  <hr>
  
			  <b>Light Direction</b><br>
			  X: <input type="range" id="dirX" min="-10" max="10" step="0.1" value="1"><br>
			  Y: <input type="range" id="dirY" min="-10" max="10" step="0.1" value="-3"><br>
			  Z: <input type="range" id="dirZ" min="-10" max="10" step="0.1" value="-5"><br>
			  <hr>
			  <b>Light Color</b><br>
			  X: <input type="range" id="colorX" min="0" max="1" step="0.01" value="1"><br>
			  Y: <input type="range" id="colorY" min="0" max="1" step="0.01" value="1"><br>
			  Z: <input type="range" id="colorZ" min="0" max="1" step="0.01" value="1"><br>
			  <hr>
			  <b>Eye Position</b><br>
			  X: <input type="range" id="eyeX" min="-10" max="10" step="0.1" value="3"><br>
			  Y: <input type="range" id="eyeY" min="-10" max="10" step="0.1" value="4"><br>
			  Z: <input type="range" id="eyeZ" min="-10" max="10" step="0.1" value="5"><br>
			  <hr>
			</div>
		  </div>
		</div>
	  </div>
</body>
</html>
